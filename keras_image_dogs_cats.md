Reference
https://github.com/llSourcell/how_to_make_an_image_classifier/blob/master/demo.ipynb
# prepare data
git clone https://github.com/gggdomi/keras-workshop.git
copy the data folder out

This step has been done.

```python
import os
import numpy as np
from keras.models import Sequential
from keras.layers import Activation, Dropout, Flatten, Dense
from keras.preprocessing.image import ImageDataGenerator
from keras.layers import Convolution2D, MaxPooling2D, ZeroPadding2D
from keras import optimizers

from keras.preprocessing import image
```


```python
# dimensions of our images.
img_width, img_height = 150, 150

train_data_dir = 'data/train'
validation_data_dir = 'data/validation'
```

### configure images and training/validattion sets


```python
# used to rescale the pixel values from [0, 255] to [0, 1] interval
datagen = ImageDataGenerator(rescale=1./255)

# automagically retrieve images and their classes for train and validation sets
train_generator = datagen.flow_from_directory(
        train_data_dir,
        target_size=(img_width, img_height),
        batch_size=32,
        class_mode='binary')

validation_generator = datagen.flow_from_directory(
        validation_data_dir,
        target_size=(img_width, img_height),
        batch_size=32,
        class_mode='binary')
```

    Found 2048 images belonging to 2 classes.
    Found 832 images belonging to 2 classes.


### define model


```python
model = Sequential()

# https://keras.io/layers/convolutional/#convolution2d
# 32 of 3x3 conv filter
model.add(Convolution2D(32, 3, 3, input_shape=(3, img_width, img_height)))
model.add(Activation('relu'))
model.add(MaxPooling2D(pool_size=(2, 2)))

model.add(Convolution2D(32, 3, 3))
model.add(Activation('relu'))
model.add(MaxPooling2D(pool_size=(2, 2)))

model.add(Convolution2D(64, 3, 3))
model.add(Activation('relu'))
model.add(MaxPooling2D(pool_size=(2, 2)))

model.add(Flatten())
model.add(Dense(64))
model.add(Activation('relu'))
model.add(Dropout(0.5))
model.add(Dense(1))
model.add(Activation('sigmoid'))

# https://keras.io/objectives/
# https://keras.io/metrics/
model.compile(loss='binary_crossentropy',
              optimizer='rmsprop',
              metrics=['accuracy'])


```

### Training


```python
nb_epoch = 20
nb_train_samples = 2048
nb_validation_samples = 832

# https://keras.io/models/sequential/#sequential-model-methods
model.fit_generator(
        train_generator,
        samples_per_epoch=nb_train_samples,
        nb_epoch=nb_epoch,
        validation_data=validation_generator,
        nb_val_samples=nb_validation_samples)

```

    Epoch 1/20
    2048/2048 [==============================] - 105s - loss: 0.7633 - acc: 0.5171 - val_loss: 0.6948 - val_acc: 0.5000
    Epoch 2/20
    2048/2048 [==============================] - 103s - loss: 0.6899 - acc: 0.5527 - val_loss: 0.6677 - val_acc: 0.6514
    Epoch 3/20
    2048/2048 [==============================] - 114s - loss: 0.6685 - acc: 0.6104 - val_loss: 0.6597 - val_acc: 0.6238
    Epoch 4/20
    2048/2048 [==============================] - 116s - loss: 0.6180 - acc: 0.6562 - val_loss: 0.6202 - val_acc: 0.6803
    Epoch 5/20
    2048/2048 [==============================] - 118s - loss: 0.5704 - acc: 0.7188 - val_loss: 0.5720 - val_acc: 0.7079
    Epoch 6/20
    2048/2048 [==============================] - 101s - loss: 0.5332 - acc: 0.7476 - val_loss: 0.5998 - val_acc: 0.7007
    Epoch 7/20
    2048/2048 [==============================] - 101s - loss: 0.4818 - acc: 0.7661 - val_loss: 0.5975 - val_acc: 0.7007
    Epoch 8/20
    2048/2048 [==============================] - 101s - loss: 0.4514 - acc: 0.7837 - val_loss: 0.5913 - val_acc: 0.7115
    Epoch 9/20
    2048/2048 [==============================] - 101s - loss: 0.4099 - acc: 0.8066 - val_loss: 0.5893 - val_acc: 0.7151
    Epoch 10/20
    2048/2048 [==============================] - 103s - loss: 0.3445 - acc: 0.8457 - val_loss: 0.6658 - val_acc: 0.7139
    Epoch 11/20
    2048/2048 [==============================] - 104s - loss: 0.3277 - acc: 0.8569 - val_loss: 0.7120 - val_acc: 0.6983
    Epoch 12/20
    2048/2048 [==============================] - 104s - loss: 0.2886 - acc: 0.8672 - val_loss: 0.6920 - val_acc: 0.7079
    Epoch 13/20
    2048/2048 [==============================] - 105s - loss: 0.2445 - acc: 0.8892 - val_loss: 0.7777 - val_acc: 0.7272
    Epoch 14/20
    2048/2048 [==============================] - 105s - loss: 0.2388 - acc: 0.8950 - val_loss: 0.7280 - val_acc: 0.7320
    Epoch 15/20
    2048/2048 [==============================] - 104s - loss: 0.1956 - acc: 0.9170 - val_loss: 0.8485 - val_acc: 0.7175
    Epoch 16/20
    2048/2048 [==============================] - 107s - loss: 0.2013 - acc: 0.9238 - val_loss: 0.9017 - val_acc: 0.6983
    Epoch 17/20
    2048/2048 [==============================] - 108s - loss: 0.1410 - acc: 0.9424 - val_loss: 0.9445 - val_acc: 0.7007
    Epoch 18/20
    2048/2048 [==============================] - 105s - loss: 0.1486 - acc: 0.9448 - val_loss: 1.1835 - val_acc: 0.7127
    Epoch 19/20
    2048/2048 [==============================] - 105s - loss: 0.1181 - acc: 0.9590 - val_loss: 1.2439 - val_acc: 0.7224
    Epoch 20/20
    2048/2048 [==============================] - 106s - loss: 0.1254 - acc: 0.9590 - val_loss: 1.2544 - val_acc: 0.7175





    <keras.callbacks.History at 0x10e374630>




```python
model.save_weights('basic_cnn_20_epochs.h5')
```

### Evaluation


```python
model.evaluate_generator(validation_generator, nb_validation_samples)
```




    [1.254442606980984, 0.71754807692307687]



### Testing


```python
# https://keras.io/applications/
img = image.load_img('cat1.jpg',target_size=(150, 150))
x = np.asarray(img, dtype='float32')
x = x.transpose(2, 0, 1)
x = np.expand_dims(x, axis=0)
```


```python
img
```




![png](output_16_0.png)




```python
x.shape
```




    (1, 3, 150, 150)




```python
preds = model.predict(x)
print(preds)
```

    [[ 0.]]



```python
img = image.load_img('dog.jpeg',target_size=(150, 150))
```


```python
img
```




![png](output_20_0.png)




```python
x = np.asarray(img, dtype='float32')
x = x.transpose(2, 0, 1)
x = np.expand_dims(x, axis=0)
preds = model.predict(x)
print(preds)
```

    [[ 1.]]

